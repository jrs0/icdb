# Generated by using Rcpp::compileAttributes() -> do not edit by hand
# Generator token: 10BE3573-1514-4C36-9D1C-5A225CD40393

#' \brief Comparison of category with raw code
#'
#' This function is the main comparison operator that is
#' used in the binary search to find a raw code in the ICD-10
#' codes file.
#' 
#' Each category has an index, which is the range of codes
#' that this category contains. The index is of the form
#' (M,N), where M and N are code roots -- e.g. (B15,B19).
#' The top of this range is inclusive, meaning that
#' the code B199 would be inside this category, even
#' though B199 > B19 lexicographically. The trick is to
#' truncate the code B199 to the length of the upper end
#' of the range before doing the check. There are also
#' categories that contain a degenerate range, of the
#' form (M,) -- e.g. (A01,). Here, any code that starts
#' with A01 is in the category (again, truncate and compare).
#'
#' The program below uses a binary search to find which
#' category a code belongs to, based on the std::upper_bound
#' function. For the purpose of this search, the categories
#' are ordered by the first element of their index, M, because
#' this guarantees that the upper element N is also ordered
#' (categories do not overlap, although there are gaps between
#' categories). For the particular string str of interest,
#' the upper bound category is the first cat such that
#' cat > str. This means that the previous cat was the last
#' cat where cat <= str. If this is applied to the start
#' of the range M, then this is the right condition to
#' find the best candidate category (where M <= str, and
#' M is maximal)
#'
#' The upper bound is enough to guarantee that "if str is
#' in any category, it is in this one". It is still necessary
#' to check that the str is not larger than the upper end
#' of the range, N. This check is performed after the search
#' is complete.
#'
NULL

#' Parse a single ICD-10 string into a vector of indices that locates
#' it in the code definition structure, and handle parsing errors. This
#' function is the counterpart to the R function icd10_str_to_indices.
#'
#' The returned object is a list containing the following fields:
#' - type: a integer describing the result of the parse. 0 for
#'   success; 1 for empty string; 2 for invalid code.
#' - indices: if success, a vector of indices locating
#' - trailing: an content at the end of the string that was not
#'   parsed (sometimes ICD-10 codes contain trailing matter -- the
#'   goal is to eventually interpret all of this)
#' - groups: a character vector of groups that contain this code
#'
#' This function is the faster implementation of the ICD-10 parser.
#' The input is a vector of strings to be parsed, and the output is
#' a list of three vectors (the same length as the input) containing
#' information about the parsed codes.
#'
#' Note: passing groups by value is deliberate, because it is
#' modified and should not modify the caller's version. Todo:
#' try to remove this, it might be possible to keep only one
#' copy and modify it globally.
#' 
#' @param str The input character vector of strings that should be
#' parsed. The strings can have leading and trailing whitespace,
#' which will be removed before parsing by this function.
#' @param code_def The code definition structure, which is a nested
#' list of lists following the structure of the icd10.yaml file.
#' @return A named list containing indices, type and groups
#' 
#' 
NULL

#' Implementation of the ICD-10 parser for vectors of ICD-10 strings
#'
#' This function is the faster implementation of the ICD-10 parser.
#' The input is a vector of strings to be parsed, and the output is
#' a list of three vectors (the same length as the input) containing
#' information about the parsed codes.
#' 
#' @param str The input character vector of strings that should be
#' parsed. The strings can have leading and trailing whitespace,
#' which will be removed before parsing by this function.
#' @param code_def The code definition structure, which is a nested
#' list of lists following the structure of the icd10.yaml file.
#' @return A named list containing indices, type and groups
#' 
#' 
new_icd10_impl <- function(str, code_def) {
    .Call(`_icdb_new_icd10_impl`, str, code_def)
}

