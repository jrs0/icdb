# Each level of this file has the same structure: a docs, source, and <contents> field. The <contents> field
# can be one of: "databases", "tables", "columns", or "strategy", which determines whether the level refers to a
# list of databases, tables, or columns, respectively.
databases:
  sus:
    docs: "The SUS database contains hospital episode statistics, which contain records of patient care activities that take place in a hospital visit."
    source_database: "ABI"
    tables:
      # Start and end dates and times were obtained by greping column
      # names for "(D|d)ate" and "(T|t)ime". Note that all occurances
      # of "Date" and "Time" used capital start letters.
      apc:
        docs: "The APC (admitted patient care) contains records from patients who have been admitted into the hospital. The rows in the table correspond to episodes: individual care activities performed by one consultant. Groups of rows are organised into spells, which represent the entirety of the patient's stay in hospital."
        source_table: "vw_APC_SEM_001"
        columns:
          nhs_number:
            docs: "The NHS number identifies the patient. The field is anonymised."
            source_columns:
              "AIMTC_Pseudo_NHS": ""
              "NHSnumber": "This one looks like it is NULL everywhere. Also, this is an INT column"
            strategy: "coalesce_exclude_null"
            use: yes
          episode_start:
            docs: "A datetime field that is the time when the episode began."
            source_columns:
              "StartDate_ConsultantEpisode": "something"
              "StartDate1": "something"
              "StartTime_Episode": "something"
            strategy: "coalesce"
            use: yes
          episode_end:
            docs: "A datetime field that is the time when the episode finished."
            source_columns:
              "EndDate_ConsultantEpisode": "something"
              "EndDate1": "something"
              "EndTime_Episode": "something"
            strategy: "coalesce"
            use: yes
          primary_diagnosis:
            docs: "The main diagnosis for this episode? The field is an ICD 10 code."
            source_columns:
              "DiagnosisPrimary_ICD": ""
            strategy: "coalesce" #["codes_from", "icd10"]
            use: yes
          spell_id:
            docs: "The ID field linking episodes that form part of the same spell (a continuous hospital visit). "
            source_columns:
              "PBRspellID": ""
            strategy: "coalesce"
            use: yes
          spell_start:
            docs: "A datetime field that is the time when the associated spell for this episode began."
            source_columns:
              "AIMTC_ProviderSpell_Start_Date": ""
              "StartDate_HospitalProviderSpell": ""
              "StartTime_HospitalProviderSpell": ""
            strategy: "coalesce"
            use: yes
          spell_end:
            docs: "A datetime field that is the time when the associated spell for this episode ended."
            source_columns:
              "AIMTC_ProviderSpell_End_Date": ""
              "DischargeDate_FromHospitalProviderSpell": ""
              "DischargeTime_HospitalProviderSpell": ""
            related_columns:
              "HospitalProviderSpellDischargeReadyDate": "probably not the end date, but maybe related."
            strategy: "coalesce"
            use: yes
      ae:
        docs: "The A&E HES data"
        source_table: "vw_AE_SEM_001"
        columns: []


  mort:
    docs: "There are two main tables containing death information....."
    source_database: "ABI"
    tables:
      civ-reg:
        docs: "The Civil Registry Mortality table contains information about when a person died and what they died of, listed as ICD10 diagnosis codes. It also has lots of other information, such as where they died."
        source_table: "test_lookup_test"
        # Raw is used to import all the columns as-is. This overrides the column key. Mapping the columns properly is preferred.
        raw: yes
        columns: []

      nhais:
        docs: "NHAIS Deaths table...."
        source_table: "test_lookup_test"
        columns: []


  swd:
    docs: "The MODELLING_SQL_AREA database contains the System Wide Dataset tables (activity, attributes, measurements), which bring together data from primary care (GPs), secondary care (hsopitals), mental health, and community care services."
    source_database: "MODELLING_SQL_AREA"
    tables:
      act:
        docs: "The SWD activity table contains records of healthcare encounters (e.g. a GP appointment) from  primary care (GPs), secondary care (hsopitals), mental health, and community care services."
        source_table: "swd_activity"
        raw: yes
        columns: []

      att:
        docs: "The SWD attributes table contains records of patient attributes at the latest snapshot through the year (monthly updates), PLUS a few other measures such as 'air quality' that is NOT present in the activity history table (these additional measures is the only reason to keep a separate reference to this table, otherwise we could have just filter the activity history table by most recent)."
        source_table: "swd_attribute"
        raw: yes
        columns: []

      att_h:
        docs: "The SWD attributes-history table contains every monthly snapshot of patient attributes going back to inception of the swd attributes table in 201X(?when, look this up)."
        source_table: "primary_care_attributes"
        raw: yes
        columns: []

      meas:
        docs: "The SWD results, or measurements, table now contains results from various tests. As there are many different types of measures all stored in a single column, this data is stored as character strings and needs to be parsed - e.g. blood pressure = as.character('123/80')."
        source_table: "swd_measurement"
        raw: yes
        columns: []

      lsoa:
        docs: "The LSOA (Lower Super Output Area) table contains details about the local areas in Bristol. We need this as it provides the key for matching patients to the various local 'regions' - in order of size: 'wards', 'LSOAs' and 'MSOAs' (Middle Super Output Areas). TODO: there are quite a few of these tables, find the right one"
        source_table: "swd_LSOA_descriptions"
        raw: yes
        columns: []
