---
title: "Development"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Development}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Library development 

This section contains notes about development, such as todo lists, etc.

### Development environment

To set up the R environment, install R 

```
## For Tauri/next.js
cargo install tauri-cli

```

### Todo list

This is the list of most important things:

- Fix the cache to flush to the level 2 cache at the end of the session (also refactor to R6)

Here is a list of other improvements that need to be made:

- Connect to the server, not a database. Arrange things so that the user can autocomplete databases before tables. Try to make it work so that the same database connection can be used in multiple dplyr pipe operations.
- Flush the level1 cache to the disk at some point (i.e. when the session ends) to shorten the load time next session. Make sure there is a clear way to disable this (it might not be a desirable default).
- Need to try to get autocomplete working in every context it makes sense (col names etc.).
- Look into replacing dbSendQuery with dbGetQuery for simplicity 
- Really need to find a way to lazily evaluate the contents of the Databases object. Currently, all the databases and tables are stored because the current autocomplete method rests of built-in autocompletion of lists -- however, this requires the list to be populated. It would be better to find a different autocomplete method that allowed lazy evaluation of completion options.
- Need to reconcile the mysql and sql server (microsoft) way of getting lists of databases and tables. mysql returns objects properly using dbListObjects, but sql server lists the databases in a table and then there is no clear way to get the tables without raw sql.
- Need to make a better error message when the user tries to get a non-existent table
- Need to test cache properly
- Need to add proper database disconnection code
- Should replace the server connection files with YAML not JSON (for consistency with everything else)
- Replace the testdata flag with proper logic for connecting to an SQLite database.
- Handle closing the database connection properly.
- Probably better to use the syntax table(srv$$dbname$tabname) instead of srv$dbname$tabname(). Then you could do srv$dbname$tabname %>% get_table(). Also, maybe there is a way to implement the non-parentheses methods even when there is a nested list -- if the \$ method could be made to check for a list, and do something different for a function.
- Found that the "SQL Server Native Client 11.0" works! Can update the documentation to reflect this.
- Want to add a way to specify a custom cache expiry, 

### Problem reports

- If a query fails (because it is invalid), the query looks like it might still getting written to the cache, so that next time you run the query, it thinks it has done it. This requires a bit of work to reproduce. Might need to look at the cache writing code order.

- Problem with parsing file paths that contain a directory component in the codes_from field of the mapping yaml file.

- Need to double check that the catch all codes are really working properly, and not classing everything in their subcategories as a catch all category. This will be solved by testing (not done yet). 

- install.packages complains about needing Rtools to build the package. Might be solved by making a binary package instead?

- Update the documentation to wrap pipe statements so you don't have to scroll horizontally.

## Documentation development

Add articles for the main package documentation in the vignettes folder, or use devtools::use_vignette("name") to create a template. 

## Notes

This section contains notes about things that work or anything else that might be helpful later.

### Renaming with janitor

This is a quick way to make good column names.

```{r, eval=FALSE}
tbl %>% rename_with(.fn = janitor::make_clean_names)
```
